using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using UnityEngine.SceneManagement;
public class Manager : MonoBehaviour {
	public int Mode;
	public bool Begin;
	public int Coins;
	public float Weight;
	public float Weight_Goal;
	public float Time_Goal;
	public Image TimerFill_UI;
	public Text Timer_Time_UI;
	public float timer;
	public Text Collectible_Text_UI;
	public Text Collectible_Goal_UI;
	public Text ItemName_UI;
	public GameObject Canvas_Gameplay;
	public AudioClip TimeEnding;
	public GameObject Debuger;
	public Transform SpawnPoint;
	private bool Pause;
	private bool outroload=false;
	public GameObject Player;
	public GameObject PauseCanvas;
	public string PauseButton;
	public string SubmitButton;
	// Use this for initialization
	void Start () {
		Application.targetFrameRate = 30;
		timer=Time_Goal;

	}
	
	// Update is called once per frame
	void FixedUpdate () {

		if(Input.GetKey (KeyCode.Joystick1Button6) && Input.GetButton (SubmitButton)){
			if(Debuger.activeSelf==false){
				Debuger.SetActive(true);
			}else{
				Debuger.SetActive(false);
			}
		}

		if(Input.GetButtonDown (PauseButton)){

			Pause=!Pause;
		//	Debug.Log (Pause);
			MainMenu();
		}

		if(Mode==2){
		if(Canvas_Gameplay.gameObject.activeSelf==true){
			Begin=true;
		}else{
			Begin=false;
		}
	if(timer>0){
			if(Begin==true){
		timer -= Time.deltaTime;

				if(timer<=20){
					GameObject.Find ("Music").GetComponent<AudioSource>().pitch = Mathf.Lerp (GameObject.Find ("Music").GetComponent<AudioSource>().pitch,1.2f,Time.deltaTime);
					this.GetComponent<AudioSource>().clip = TimeEnding;
					this.GetComponent<AudioSource>().loop=true;
					if(this.GetComponent<AudioSource>().isPlaying==false){
					this.GetComponent<AudioSource>().Play();
					}
				}

			}
		}else{
				if(outroload==false){
					OutroScene();
				}
		
		}
		}
		Timer_Time_UI.text = "Time: "+Mathf.RoundToInt(timer).ToString ();
		TimerFill_UI.fillAmount = ((100/Time_Goal)*Mathf.RoundToInt(timer))/100;
		Collectible_Text_UI.text = Weight.ToString ("F1");
		if(Weight_Goal==0f){
			Collectible_Goal_UI.text = "None";
		}else{
		Collectible_Goal_UI.text = Weight_Goal.ToString ();
		}
	}

	void OutroScene(){

		LoadingBeh.ExtraLevelString="";
		GameObject.Find("Loading").GetComponent<LoadingBeh>().GoToLevelFunct("MainMenu");
		//outroload=true;
	//	SceneManager.LoadScene("DemoOutro");
	}

	public void ResetPlayer(){
		Player.transform.rotation = SpawnPoint.rotation;
		Player.transform.position = SpawnPoint.position;
	}
	public void MainMenu(){
		Player.GetComponent<Player>().moveplayer=!Pause;
		PauseCanvas.SetActive(Pause);
		if(Pause==true){
		//	Time.timeScale=0.01f;
			//Player.GetComponent<Rigidbody>().constraints = RigidbodyConstraints.FreezeAll;
		}else{
			//Time.timeScale=1;
			//Player.GetComponent<Rigidbody>().constraints  = RigidbodyConstraints.None;
		}
	}
}
